using System.IO;
using UnityEngine;
using UnityEditor;
using homehelp.Events;

namespace homehelp.Variables
{
    [CanEditMultipleObjects]
    [CustomEditor(typeof(_className_Variable))]
    public class _className_VariableEditor : Editor
    {
        private int _type;
        private _className_Variable __className_Variable;

        public void OnEnable()
        {
            __className_Variable = (_className_Variable) target;
        }

        public override void OnInspectorGUI()
        {
            GUILayout.BeginHorizontal();
            GUILayout.Label("Game Event Type");
            _type = GUILayout.Toolbar(_type, new string[] {"_className_", "Void", "_className_ and Void"},
                GUILayout.Width(Screen.width * 0.595f));
            GUILayout.EndHorizontal();

            GUILayout.Space(10);
            switch (_type)
            {
                case 0:
                    GUILayout.Label("Value: " + __className_Variable.Value);
                    __className_Variable.gameEventType = _className_Variable.GameEventType._className_;
                    __className_Variable.changedEvent_className_ = (GameEvent_className_) EditorGUILayout.ObjectField("Game Event _className_",
                        __className_Variable.changedEvent_className_, typeof(GameEvent_className_), false);
                    break;
                case 1:
                    __className_Variable.gameEventType = _className_Variable.GameEventType.Void;
                    __className_Variable.changedEventVoid = (GameEventVoid) EditorGUILayout.ObjectField("Game Event Void",
                        __className_Variable.changedEventVoid, typeof(GameEventVoid), false);
                    break;
                default:
                    GUILayout.Label("Value: " + __className_Variable.Value);
                    __className_Variable.gameEventType = _className_Variable.GameEventType._className_AndVoid;
                    __className_Variable.changedEvent_className_ = (GameEvent_className_) EditorGUILayout.ObjectField("Game Event _className_",
                        __className_Variable.changedEvent_className_, typeof(GameEvent_className_), false);
                    __className_Variable.changedEventVoid = (GameEventVoid) EditorGUILayout.ObjectField("Game Event Void",
                        __className_Variable.changedEventVoid, typeof(GameEventVoid), false);
                    break;
            }

            GUILayout.Space(10);
            EditorGUILayout.HelpBox("If you don't want to raise a game event just keep the GameEvent as None",
                MessageType.Info);

            #region Interface

            EditorGUI.BeginDisabledGroup(Application.isPlaying);

            var buttonStyle = new GUIStyle(GUI.skin.button)
            {
                alignment = TextAnchor.MiddleCenter,
                fixedWidth = 200f,
                margin = new RectOffset(0, 0, 20, 10),
            };

            if (GUILayout.Button("Create interface", buttonStyle))
            {
                CreateInterface(__className_Variable.name);
            }
            EditorGUILayout.HelpBox("Do not create variables with white spaces", MessageType.Warning);

            EditorGUI.EndDisabledGroup();

            #endregion

#if UNITY_EDITOR
            EditorUtility.SetDirty(target);
#endif
        }
        
        #region Interface creation
        /// <summary>
        /// O game event void será o único diferente devido
        /// a não poder passar parametros
        /// </summary>
        public static void CreateInterface(string name)
        {
            var fullPath = AssetDatabase.GetAssetPath(Selection.activeObject);
            var fileName = string.Concat("I", name, ".cs");

            var directoryPath = string.Concat(fullPath.Substring(0, fullPath.Length - name.Length - 6), "Interfaces/");
            if (!Directory.Exists(directoryPath))
            {
                Directory.CreateDirectory(directoryPath);
            }

            var newFilePath = string.Concat(directoryPath, fileName);
            
            if (File.Exists(newFilePath))
            {
                File.Delete(newFilePath);
            }
            
            using (var streamWriter = new StreamWriter(newFilePath))
            {
                var code = string.Concat("public interface ", "I", name,"\n{\n", "\t_className_ ", "SetVariableValueProcess", "(_className_ value);", "\n}\n");
                streamWriter.Write(code);
            }
            
            AssetDatabase.Refresh();
        }
        #endregion
    }
}